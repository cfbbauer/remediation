param (
    [string]$logfolder
)

if (!$logfolder) {
    $logfolder = "c:\Temp"
    Write-Host "`n`nParameter is null or empty.  Using c:\Temp directory for logfile.`n"

    if (!(Test-Path -Path $logfolder)) {
        New-Item -ItemType Directory -Path $logfolder
        Write-Host "Folder '$logfolder' created successfully.`n"
        } else {
        Write-Host "Folder '$logfolder' already exists.`n"
    }
}

$logfile = "$logfolder\remediate-CV-2025-21172-logfile.log"

Start-Transcript -Path $logfile

Write-Host "`n  Starting to remediate CVE-2025-21172 on computer $env:computername `n"

$storagePath = "\\sifs\Administration\ITDept\Applications\Microsoft\dotNet Updates\"


$executable = "aspnetcore-runtime-8.0.15-win-x64.exe"
$filePath = "$storagePath$executable"

Write-Host "FilePath  $filePath"
Copy-Item -Path $filePath -Destination $logfolder

if ($?) { Write-host "Copied ASP installer locally without error.`n"
    } else {
    Write-Host "Copy ASP installer locally failed.`n"
    }

$filePath = "$logfolder\$executable"

$argumentsList = "/install /quiet /norestart /log c:\temp\ASPnet-install.log"

Write-Host "`nProcessing ASP.net 8.0.15 install"
Write-Host $filePath

Start-Process -FilePath $filePath -ArgumentList $argumentsList -wait

if ($?) { Write-host "Process completed without error.`n"
    } else {
    Write-Host "Process completed with an error.`n"
    }


$executable = "windowsdesktop-runtime-8.0.15-win-x64.exe"
$filePath = "$storagePath$executable"

Write-Host "FilePath  $filePath"
Copy-Item -Path $filePath -Destination $logfolder

if ($?) { Write-host "Copied WinDesktop installer locally without error.`n"
    } else {
    Write-Host "Copy WinDesktop installer locally failed.`n"
    }

$filePath = "$logfolder\$executable"

$argumentsList = "/install /quiet /norestart /log c:\temp\WinDesktop-install.log"

Write-Host "`nProcessing WindowsDesktop Runtime 8.0.15 install"
Write-Host "$filePath $argumentsList"

Start-Process -FilePath $filePath -ArgumentList $argumentsList -wait

if ($?) { Write-host "Process completed without error.`n"
    } else {
    Write-Host "Process completed with an error.`n"
    }



Stop-Transcript